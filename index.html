
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Eindeepseek · 产品展示</title>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SP9BZHN30E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SP9BZHN30E');
  </script>

  <style>
    :root{--bg:#f7f8fa;--text:#1f2328;--muted:#5b606a;--border:#e5e7eb;--card:#fff;--primary:#0969da}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);padding:10px 16px;z-index:10;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:800}
    .lang button{border:none;background:transparent;padding:6px 10px;border-radius:999px;cursor:pointer;color:var(--muted)}
    .lang button.active{background:var(--primary);color:#fff}
    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 60px}
    h1{margin:.5rem 0 0;font-size:26px}
    .sub{color:var(--muted);margin:4px 0 14px}
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:20px}
    @media(min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{display:block;text-decoration:none;color:inherit;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .thumb{width:100%;aspect-ratio:4/3;object-fit:cover;background:#f0f2f4;display:block}
    .body{padding:10px 12px}
    .title{font-weight:700}
    .skeleton{position:relative;overflow:hidden;background:#eef1f5}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,#f7f8fb,transparent);animation:1.2s shimmer infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    .group{display:flex;gap:12px;align-items:center;background:#fff;border:1px dashed var(--border);border-radius:14px;padding:8px 10px}
    .group img{width:86px;height:86px;border-radius:10px;object-fit:cover}
    .group .meta{flex:1}
    .group .btn{display:inline-block;background:#111;color:#fff;padding:8px 12px;border-radius:10px;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div class="brand">Eindeepseek</div>
    <div class="lang" id="lang">
      <button data-lang="zh">ZH</button>
      <button data-lang="en">EN</button>
      <button data-lang="de">DE</button>
    </div>
  </header>

  <div class="wrap">
    <h1 id="h">产品展示</h1>
    <div class="sub" id="sub">选择语言后会在全站生效；仅显示有首图的产品。</div>

    <div class="grid" id="grid">
      <div class="card"><div class="thumb skeleton"></div><div class="body"><div class="title skeleton" style="height:18px;width:60%"></div></div></div>
      <div class="card"><div class="thumb skeleton"></div><div class="body"><div class="title skeleton" style="height:18px;width:60%"></div></div></div>
      <div class="card"><div class="thumb skeleton"></div><div class="body"><div class="title skeleton" style="height:18px;width:60%"></div></div></div>
    </div>

    <h2 style="margin:24px 0 10px">WhatsApp 群</h2>
    <a class="group" id="groupLink" href="group.jpeg" target="_blank" rel="noopener">
      <img src="group.jpeg" alt="WhatsApp 群二维码" loading="lazy" decoding="async">
      <div class="meta">
        <div style="font-weight:700;margin-bottom:4px">加入交流群</div>
        <div style="color:#6b7280">扫码进群，获取最新产品与物流信息</div>
      </div>
      <span class="btn">打开二维码</span>
    </a>
  </div>

  <script>
    const GAID='G-SP9BZHN30E';
    const qs=new URLSearchParams(location.search);
    const currentLang=(qs.get('lang')||localStorage.getItem('lang')||'zh').toLowerCase();
    localStorage.setItem('lang', currentLang);

    const I18N={
      zh:{title:'产品展示',sub:'选择语言后会在全站生效；仅显示有首图的产品。'},
      en:{title:'Products',sub:'Language selection applies site-wide. Only products with a hero image are shown.'},
      de:{title:'Produkte',sub:'Sprachauswahl wirkt global. Es werden nur Produkte mit Startbild angezeigt.'}
    };
    document.getElementById('h').textContent=(I18N[currentLang]||I18N.zh).title;
    document.getElementById('sub').textContent=(I18N[currentLang]||I18N.zh).sub;
    [...document.querySelectorAll('#lang button')].forEach(b=>{ if(b.dataset.lang===currentLang)b.classList.add('active'); b.onclick=()=>{ const lang=b.dataset.lang; localStorage.setItem('lang',lang); const url=new URL(location.href); url.searchParams.set('lang',lang); location.href=url.toString(); }; });

    document.getElementById('groupLink').addEventListener('click',()=>{
      try{ gtag('event','click_group',{location:'home'});}catch{}
    });

    function fetchWithTimeout(url, ms=1200){
      const ctl=new AbortController(); const t=setTimeout(()=>ctl.abort(),ms);
      return fetch(url,{signal:ctl.signal,cache:'no-store'}).finally(()=>clearTimeout(t));
    }

    async function jsonFast(url){ try{ const r=await fetchWithTimeout(url,1500); if(r.ok) return await r.json(); }catch{} return null; }
    async function exists(url){ try{ const r=await fetchWithTimeout(url,1200); return r.ok; }catch{return false;} }

    (async function build(){
      const grid=document.getElementById('grid'); grid.innerHTML='';
      const mf = await jsonFast('products/manifest.json'); // manifest 在 /products
      if(!mf?.items) return;
      const lang=currentLang;

      for(const it of mf.items){
        const ext = it.imgExt || 'jpg';
        const hero = `assets/imgs/product-${it.id}/1.${ext}`;
        const detail = `product-${it.id}.html`; // 旧命名
        const okImg = await exists(hero);
        // 仅渲染有首图 & 详情页存在才显示
        const okPage = await exists(detail);
        if(!okImg || !okPage) continue;

        const title = (it.title && it.title[lang]) || it?.title?.zh || ('产品 '+it.id);
        const a = document.createElement('a');
        const url = new URL(detail, location.href);
        url.searchParams.set('lang', lang);
        a.href = url.toString();
        a.className='card';
        a.onclick=()=>{ try{ sessionStorage.setItem('heroSrc-'+it.id, hero); gtag('event','click_product',{product_id:it.id,product_name:title}); }catch{} };
        a.innerHTML = `
          <img class="thumb" src="${hero}" alt="${title}" loading="eager" decoding="async">
          <div class="body"><div class="title">${title}</div></div>
        `;
        grid.appendChild(a);
      }
    })();
  </script>
</body>
</html>
