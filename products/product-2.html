
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eindeepseek – Product 2</title>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SP9BZHN30E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SP9BZHN30E');
  </script>

  <link rel="dns-prefetch" href="//www.eindeepseek.com">
  <link rel="preconnect" href="https://www.eindeepseek.com" crossorigin>

  <style>
    :root{--bg:#f7f8fa;--text:#222;--muted:#555;--primary:#2b7de9;--border:#e5e7eb;--card:#fff;--skeleton:#eef1f5;--shimmer:#f7f8fb}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;border-bottom:1px solid var(--border)}
    .brand a{color:var(--text);text-decoration:none;font-weight:800}
    .lang{display:inline-flex;gap:6px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px}
    .lang button{appearance:none;border:none;cursor:pointer;padding:6px 10px;border-radius:999px;color:var(--muted);background:transparent;font-weight:600}
    .lang button.active{color:#fff;background:var(--primary)}
    .wrap{max-width:1200px;margin:0 auto;padding:18px 16px 56px}
    .layout{display:grid;gap:18px}
    @media(min-width:900px){.layout{grid-template-columns:1.15fr .85fr;align-items:start}}
    .title{font-size:28px;font-weight:800;margin:8px 0}
    .desc{color:var(--muted);line-height:1.6;white-space:pre-wrap;word-wrap:break-word}

    .carousel{position:relative;overflow:hidden;border-radius:14px;border:1px solid var(--border);background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .track{display:flex;transition:transform .45s ease;will-change:transform}
    .slide{min-width:100%;user-select:none}
    .slide img{display:block;width:100%;height:auto;object-fit:cover}
    .navBtn{position:absolute;top:50%;transform:translateY(-50%);background:#fff;border:1px solid var(--border);color:#333;border-radius:10px;padding:8px 10px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .prev{left:8px}.next{right:8px}
    .dots{display:flex;justify-content:center;gap:6px;margin-top:10px}
    .dot{width:8px;height:8px;border-radius:50%;background:#cfd3da;border:none}
    .dot.active{background:#2b7de9}

    .panel{background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:14px}
    .meta{display:grid;grid-template-columns:1fr 1fr;gap:8px 12px;font-size:14px;color:#333;margin-top:8px}
    .meta div{padding:6px 8px;background:#fafafa;border:1px solid #eee;border-radius:10px}
    .cta{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{background:#111;color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.secondary{background:#eef2ff;color:#1e40af}

    .skeleton{position:relative;overflow:hidden;background:var(--skeleton)}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,var(--shimmer),transparent);animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
  </style>
</head>
<body>
  <header>
    <div class="brand"><a id="homeLink" href="../index.html">Eindeepseek</a></div>
    <div class="lang" id="langSwitcher">
      <button data-lang="zh">ZH</button>
      <button data-lang="en">EN</button>
      <button data-lang="de">DE</button>
    </div>
  </header>

  <div class="wrap">
    <div class="layout">
      <section>
        <div class="carousel" id="carousel" aria-label="gallery">
          <div class="track" id="track">
            <div class="slide" id="heroSlide"><div class="skeleton" style="aspect-ratio:4/3;width:100%"></div></div>
          </div>
          <button class="navBtn prev" id="prev" aria-label="Prev">◀</button>
          <button class="navBtn next" id="next" aria-label="Next">▶</button>
        </div>
        <div class="dots" id="dots"></div>
      </section>

      <aside class="panel">
        <h1 class="title" id="title">Product 2</h1>
        <div class="desc" id="desc"></div>
        <div class="meta" id="specs"></div>
        <div class="cta">
          <a class="btn" id="btnBuy" href="javascript:void(0)">联系购买</a>
          <a class="btn secondary" id="btnShare" href="javascript:void(0)">复制链接</a>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const PRODUCT_ID=2;
    const qs=new URLSearchParams(location.search);
    const currentLang=(qs.get('lang')||localStorage.getItem('lang')||'zh').toLowerCase();
    localStorage.setItem('lang',currentLang);
    const home=new URL('../index.html',location.href); home.searchParams.set('lang',currentLang); document.getElementById('homeLink').href=home.toString();
    [...document.querySelectorAll('#langSwitcher button')].forEach(b=>{if(b.dataset.lang===currentLang)b.classList.add('active');b.onclick=()=>{const url=new URL(location.href);url.searchParams.set('lang',b.dataset.lang);localStorage.setItem('lang',b.dataset.lang);location.href=url.toString();}});

    function fetchWithTimeout(url,ms=1200){const ctl=new AbortController();const id=setTimeout(()=>ctl.abort(),ms);return fetch(url,{cache:'no-store',signal:ctl.signal}).finally(()=>clearTimeout(id));}
    async function jsonFast(url){try{const r=await fetchWithTimeout(url,1500); if(r.ok) return await r.json();}catch{} return null;}
    async function exists(u){try{const r=await fetchWithTimeout(u,900); return r.ok;}catch{return false;}}

    function setHeroInstant(src,alt){
      const slide=document.getElementById('heroSlide');
      slide.innerHTML=`<img src="${src}" alt="${alt}" loading="eager" decoding="async" fetchpriority="high">`;
    }

    async function loadTxt(){const slug=`product-${PRODUCT_ID}`; const order=[currentLang,'en','zh','de']; for(const lg of order){const url=`${slug}-${lg}.txt`; try{const r=await fetchWithTimeout(url,1200); if(r.ok){const t=(await r.text()).trim(); const [first,...rest]=t.split(/\r?\n/); return {title:first?.trim()||`Product ${PRODUCT_ID}`, desc:rest.join('\n').trim()||''};}}catch{} } return {title:`Product ${PRODUCT_ID}`,desc:''}; }

    async function loadImages(mfItem){
      const base=`../assets/imgs/product-${PRODUCT_ID}`;
      const ext= mfItem?.imgExt || 'jpg';
      const count = mfItem?.count || 1;
      const link=document.createElement('link'); link.rel='preload'; link.as='image'; link.href=`${base}/1.${ext}`; document.head.appendChild(link);
      const imgs=[];
      for(let i=1;i<=count;i++){ const u=`${base}/${i}.${ext}`; if(i===1 || await exists(u)) imgs.push(u); }
      return imgs;
    }

    (async function init(){
      const mf=await jsonFast('manifest.json'); // <-- manifest is in /products now
      const item = mf?.items?.find(x=>x.id==PRODUCT_ID);

      const data=await loadTxt(); title.textContent=data.title; desc.textContent=data.desc;
      try{ const cached=sessionStorage.getItem('heroSrc-'+PRODUCT_ID); if(cached) setHeroInstant(cached, data.title); }catch(e){}

      const specs = item?.specs || {};
      const specEl=document.getElementById('specs');
      const keys=Object.keys(specs);
      specEl.innerHTML = keys.length ? keys.map(k=>`<div><strong>${k}：</strong>${specs[k]}</div>`).join('') : '<div>参数待补充</div>';

      const imgs=await loadImages(item);
      const track=document.getElementById('track'); const dots=document.getElementById('dots');
      if(!(track.children.length && track.children[0].querySelector('img'))) track.innerHTML='';
      imgs.forEach((src,idx)=>{
        if(idx===0 && document.querySelector('#heroSlide img')) return;
        const s=document.createElement('div'); s.className='slide';
        s.innerHTML=`<img src="${src}" alt="${data.title} ${idx+1}" loading="${idx===0?'eager':'lazy'}" decoding="async" fetchpriority="${idx===0?'high':'auto'}">`;
        track.appendChild(s);
      });

      const total=track.children.length;
      dots.innerHTML='';
      for(let i=0;i<total;i++){ const d=document.createElement('button'); d.className='dot'+(i===0?' active':''); d.onclick=()=>go(i); dots.appendChild(d); }
      let index=0; const prev=document.getElementById('prev'), next=document.getElementById('next');
      function update(){ document.getElementById('track').style.transform=`translateX(${-index*100}%)`; [...dots.children].forEach((d,i)=>d.classList.toggle('active',i===index)); }
      function go(i){ index=Math.max(0,Math.min(total-1,i)); update(); }
      prev.onclick=()=>go(index-1); next.onclick=()=>go(index+1);

      document.getElementById('btnShare').onclick=()=>{ navigator.clipboard?.writeText(location.href); alert('已复制链接'); };
      document.getElementById('btnBuy').onclick=()=>{ location.href='mailto:wengandy128@gmail.com?subject='+encodeURIComponent('咨询 - '+data.title); };
    })();
  </script>
</body>
</html>
